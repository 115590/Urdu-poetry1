<!DOCTYPE html>
<html lang="ur" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø±Ø¯Ùˆ Ø´Ø§Ø¹Ø±ÛŒ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Jameel+Noori+Nastaleeq&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lateef&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet"> 
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <style>
        /* Default (Dark) Theme Variables - Shades of Blue */
        :root {
            --primary-bg: #0D47A1; /* Deep Navy Blue */
            --secondary-bg: #1565C0; /* Darker Medium Blue */
            --accent-color: #1E88E5; /* Medium Blue */
            --hover-color: #42A5F5; /* Lighter Blue for hover */

            --dark-text: #E3F2FD; /* Very Light Blue-Gray */
            --light-text: #BBDEFB; /* Light Blue */

            --header-footer-bg: #0B3C91; /* Darker shade of primary-bg for header/footer */
            --header-footer-text: var(--dark-text);
            --header-title-neon-color: #00FFFF; /* Cyan for dark theme neon */
            --header-title-neon-shadow1: rgba(0, 255, 255, 0.8);
            --header-title-neon-shadow2: rgba(0, 255, 255, 0.6);
            --header-title-neon-shadow3: rgba(0, 255, 255, 0.4);


            /* Dark Theme Poetry Card Colors */
            --poetry-card-bg: #1A237E; /* Deep Indigo - keeping this for contrast */
            --poetry-card-text: #E0E0E0; /* Light Gray */

            /* Alert Background and Text */
            --alert-bg: #000000;
            --alert-text: #FFFFFF;
            --alert-accent: #FFEB3B;

            /* Footer Card Colors - Dark Theme */
            --footer-card-bg: #0D47A1; /* Deep Navy Blue */
            --footer-card-text: #E3F2FD; /* Very Light Blue-Gray */

            /* Alert Border/Glow Colors - Black */
            --alert-glow-start-dark: #000000;
            --alert-glow-end-dark: #000000;

            /* Dynamic Stroke Colors for Poetry Cards (set by JS) */
            --card-stroke-start: transparent;
            --card-stroke-end: transparent;

            /* Welcome Intro Colors */
            --welcome-overlay-bg-dark: rgba(13, 71, 161, 0.97); 

            /* Gemini Modal Colors */
            --gemini-modal-bg-dark: rgba(10, 25, 47, 0.95); /* Very dark blue, slightly transparent */
            --gemini-modal-content-bg-dark: #0B3C91; /* Dark blue, matching header/footer */
            --gemini-modal-text-dark: #E3F2FD;
            --gemini-modal-title-dark: #00FFFF; /* Cyan, matching neon */
            --gemini-input-bg-dark: #1E293B; /* Tailwind slate-800 */
            --gemini-input-border-dark: #334155; /* Tailwind slate-700 */
            --gemini-btn-primary-bg-dark: #059669; /* Tailwind emerald-600 */
            --gemini-btn-primary-hover-dark: #047857; /* Tailwind emerald-700 */
        }

        /* Light Theme Overrides - Lighter Shades of Blue */
        html[data-theme="light"] {
            --primary-bg: #E3F2FD; 
            --secondary-bg: #BBDEFB; 
            --accent-color: #90CAF9; 
            --hover-color: #64B5F6; 

            --dark-text: #0D47A1; 
            --light-text: #1565C0; 

            --header-footer-bg: #B3E5FC; 
            --header-footer-text: var(--dark-text);
            --header-title-neon-color: #1E88E5; 
            --header-title-neon-shadow1: rgba(30, 136, 229, 0.8);
            --header-title-neon-shadow2: rgba(30, 136, 229, 0.6);
            --header-title-neon-shadow3: rgba(30, 136, 229, 0.4);


            /* Light Theme Poetry Card Colors */
            --poetry-card-bg: #FFFFFF; 
            --poetry-card-text: var(--dark-text);

            /* Alert Background and Text */
            --alert-bg: #FFFFFF; 
            --alert-text: #000000; 
            --alert-accent: #FF8F00; 


            /* Footer Card Colors - Light Theme */
            --footer-card-bg: #BBDEFB; 
            --footer-card-text: var(--dark-text);

            /* Alert Border/Glow Colors - Light theme */
            --alert-glow-start-light: #E0E0E0;
            --alert-glow-end-light: #BDBDBD;

            /* Welcome Intro Colors */
            --welcome-overlay-bg-light: rgba(227, 242, 253, 0.97);

             /* Gemini Modal Colors */
            --gemini-modal-bg-light: rgba(227, 242, 253, 0.95); /* Very light blue, slightly transparent */
            --gemini-modal-content-bg-light: #FFFFFF; /* White */
            --gemini-modal-text-light: #0D47A1; /* Dark blue text */
            --gemini-modal-title-light: #1E88E5; /* Medium blue title */
            --gemini-input-bg-light: #F1F5F9; /* Tailwind slate-100 */
            --gemini-input-border-light: #CBD5E1; /* Tailwind slate-300 */
            --gemini-btn-primary-bg-light: #10B981; /* Tailwind emerald-500 */
            --gemini-btn-primary-hover-light: #059669; /* Tailwind emerald-600 */
        }

        /* Common Styles */
        body {
            font-family: 'Noto Nastaliq Urdu', sans-serif;
            background: linear-gradient(-45deg, var(--primary-bg), var(--secondary-bg), var(--accent-color), var(--primary-bg));
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
            margin: 0;
            padding: 0;
            direction: rtl;
            text-align: center;
            min-height: 100vh;
            color: var(--dark-text);
            position: relative;
            transition: background 0.8s ease, color 0.8s ease;
            overflow-x: hidden;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .welcome-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--welcome-overlay-bg-dark);
            display: flex; justify-content: center; align-items: center;
            z-index: 9999; opacity: 1; visibility: visible;
            transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
            cursor: pointer;
        }
        html[data-theme="light"] .welcome-overlay { background-color: var(--welcome-overlay-bg-light); }
        .welcome-overlay.hidden { opacity: 0; visibility: hidden; }
        .welcome-text {
            font-family: 'Lateef', 'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', cursive;
            font-size: clamp(4rem, 18vw, 10rem); font-weight: bold;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5);
            animation: fadeInScaleUp 1.5s ease-out forwards; padding: 20px;
            background: linear-gradient(45deg, #FFD700, #FF69B4, #00FFFF, #ADFF2F);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; text-fill-color: transparent;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.3));
        }
        @keyframes fadeInScaleUp {
            0% { opacity: 0; transform: scale(0.7) rotate(-5deg); }
            100% { opacity: 1; transform: scale(1) rotate(0deg); }
        }

        header {
            background: var(--header-footer-bg); color: var(--header-footer-text);
            padding: 15px 0; box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            position: sticky; top: 0; z-index: 1000;
            animation: headerSlideDown 0.8s ease-out forwards;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            min-height: 80px; transition: background-color 0.5s ease, color 0.5s ease;
            width: 100%; box-sizing: border-box;
        }
        @keyframes headerSlideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .header-content {
            flex-grow: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        header h1 {
            font-family: 'Orbitron', 'Noto Nastaliq Urdu', sans-serif; 
            margin: 0; font-size: clamp(2.5em, 5vw, 3.5em); 
            color: var(--header-title-neon-color); font-weight: 700; 
            animation: neonFlicker 2s infinite alternate; letter-spacing: 1px;
            transition: color 0.5s ease, text-shadow 0.5s ease;
        }
        @keyframes neonFlicker {
            0%, 18%, 22%, 25%, 53%, 57%, 100% {
                text-shadow:
                    0 0 5px var(--header-title-neon-shadow1), 0 0 10px var(--header-title-neon-shadow1),
                    0 0 20px var(--header-title-neon-shadow2), 0 0 40px var(--header-title-neon-color),
                    0 0 70px var(--header-title-neon-shadow3), 0 0 80px var(--header-title-neon-shadow3),
                    0 0 100px var(--header-title-neon-shadow3);
            }
            20%, 24%, 55% { text-shadow: none; }
        }
        .header-buttons { display: flex; flex-direction: row; gap: 12px; margin-top: 12px; }
        .theme-toggle-button, .whatsapp-button, .gemini-generate-btn {
            background: transparent; border: 2px solid var(--header-footer-text);
            border-radius: 50%; width: 48px; height: 48px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: all 0.3s ease; 
            font-size: 1.8em; color: var(--header-footer-text);
            box-shadow: 0 3px 7px rgba(0, 0, 0, 0.25); text-decoration: none;
        }
        .gemini-generate-btn { /* Specific style for the new global button if needed, or make it look like others */
             border-radius: 8px; /* Can be rectangular */
             width: auto; padding: 8px 15px; font-size: 1em; font-family: 'Noto Nastaliq Urdu', sans-serif;
        }

        .theme-toggle-button:hover, .whatsapp-button:hover, .gemini-generate-btn:hover {
            background-color: var(--hover-color); border-color: var(--hover-color);
            color: var(--primary-bg); transform: scale(1.1) rotate(5deg);
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        .gemini-generate-btn:hover {
             transform: scale(1.05) translateY(-2px); /* Less rotation for rectangular button */
        }
        html[data-theme="light"] .theme-toggle-button:hover,
        html[data-theme="light"] .whatsapp-button:hover,
        html[data-theme="light"] .gemini-generate-btn:hover {
             background-color: var(--hover-color); color: var(--primary-bg);
        }
        .theme-toggle-button .icon { transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        html[data-theme="light"] .theme-toggle-button .icon { transform: rotate(360deg) scale(1.1); }
        html[data-theme="dark"] .theme-toggle-button .icon { transform: rotate(0deg) scale(1); }

        .poetry-container-wrapper {
            padding: 20px 10px;
        }
        .global-actions {
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .poetry-container {
            display: flex; flex-wrap: wrap; justify-content: center;
             /* padding handled by wrapper */ gap: 25px;
        }
        .poetry-card {
            background: var(--poetry-card-bg); width: 300px; 
            padding: 20px; /* Adjusted padding */ margin: 0; 
            border-radius: 15px; box-shadow: 0 8px 18px rgba(0, 0, 0, 0.2);
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), background-color 0.5s ease;
            text-align: center; line-height: 1.9; 
            display: flex; flex-direction: column; justify-content: space-between;
            position: relative; z-index: 1; overflow: hidden;
            border: 1px solid transparent; 
        }
        .poetry-card::before {
            content: ''; position: absolute; top: -5px; left: -5px; right: -5px; bottom: -5px;
            background: linear-gradient(60deg, var(--card-stroke-start), var(--card-stroke-end), var(--card-stroke-start));
            background-size: 300% 300%; z-index: -1; border-radius: 20px;
            filter: blur(12px); opacity: 0.6; transition: all 0.6s ease;
            animation: gradientShift 6s ease infinite; 
        }
        .poetry-card:hover::before { filter: blur(18px); opacity: 1; transform: scale(1.05); animation-play-state: paused; }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; }
        }
        .poetry-card:hover { transform: scale(1.05) translateY(-8px); box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3); }
        .poetry-card h3 {
            color: var(--poetry-card-text); font-family: 'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', sans-serif;
            font-size: 1.8em; margin-bottom: 10px; /* Reduced margin */
            border-bottom: 2px solid var(--accent-color); padding-bottom: 8px;
            display: inline-block; text-align: center; width: auto; 
            min-width: 60%; align-self: center;
            transition: color 0.5s ease, border-color 0.5s ease;
        }
        html[data-theme="light"] .poetry-card h3 { border-bottom-color: var(--secondary-bg); }
        .poetry-card p {
            color: var(--poetry-card-text); font-size: 1.4em; 
            line-height: 1.7; margin-top: 8px; /* Reduced margin */ margin-bottom: 15px; /* Added margin bottom */
            text-align: center; transition: color 0.5s ease;
            text-shadow: 0.5px 0.5px 1px rgba(0, 0, 0, 0.1);
            flex-grow: 1; 
        }
        .poetry-card-actions {
            margin-top: auto; /* Pushes actions to the bottom */
            padding-top: 10px; /* Space above buttons */
        }
        .gemini-explain-btn {
            background-color: var(--accent-color);
            color: var(--primary-bg);
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Noto Nastaliq Urdu', sans-serif;
            font-size: 0.9em;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: inline-flex; /* For aligning icon and text */
            align-items: center;
            gap: 5px; /* Space between icon and text */
        }
        .gemini-explain-btn:hover {
            background-color: var(--hover-color);
            transform: translateY(-2px);
        }
        html[data-theme="light"] .gemini-explain-btn {
            color: var(--poetry-card-bg); /* Ensure good contrast on light cards */
        }


        footer {
            background: var(--header-footer-bg); color: var(--header-footer-text);
            padding: 20px; width: 100%; box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.25);
            font-size: 1em; display: flex; flex-direction: column;
            justify-content: center; align-items: center; flex-wrap: wrap;
            margin-top: auto; transition: background-color 0.5s ease, color 0.5s ease;
        }
        .footer-card {
            background-color: var(--footer-card-bg); color: var(--footer-card-text);
            padding: 20px 30px; margin-bottom: 20px; border-radius: 12px;
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.35); font-size: 1.15em;
            font-weight: bold; text-align: center; max-width: 400px; width: 90%;
            transition: background-color 0.5s ease, color 0.5s ease, transform 0.3s ease, box-shadow 0.3s ease;
            line-height: 1.6; display: flex; flex-direction: column;
            align-items: center; gap: 10px;
        }
        .footer-card p, .footer-card a {
            margin: 0; color: var(--footer-card-text); text-decoration: none;
            transition: color 0.5s ease;
        }
        .footer-card a:hover { color: var(--hover-color); text-decoration: underline; transform: scale(1.05); }
        .footer-card:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 8px 18px rgba(0, 0, 0, 0.45); }
        .akram-logo {
            font-size: 0.9em; margin-top: 15px; opacity: 0.9;
            font-family: 'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', sans-serif;
            color: var(--footer-card-text); letter-spacing: 0.5px;
            animation: pulseLogo 3s infinite ease-in-out; 
        }
        @keyframes pulseLogo {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.03); }
        }

        .custom-alert-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.75); 
            display: flex; justify-content: center; align-items: center;
            z-index: 2000; opacity: 0; visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            backdrop-filter: blur(5px); 
        }
        .custom-alert-overlay.show { opacity: 1; visibility: visible; }
        .custom-alert-box {
            background-color: var(--alert-bg); color: var(--alert-text);
            padding: 25px; border-radius: 15px; 
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6); 
            max-width: 320px; width: 90%; text-align: center;
            position: relative; z-index: 1; overflow: hidden;
            transform: scale(0.7) rotate(-5deg); 
            opacity: 0;
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.4s ease, background-color 0.5s ease;
        }
        .custom-alert-overlay.show .custom-alert-box { transform: scale(1) rotate(0deg); opacity: 1; }
        .custom-alert-box::before {
            content: ''; position: absolute; top: -8px; left: -8px; right: -8px; bottom: -8px;
            background: linear-gradient(45deg, var(--alert-glow-start-dark), var(--alert-glow-end-dark));
            background-size: 200% 200%; z-index: -1; border-radius: 20px;
            filter: blur(15px); opacity: 0.8; transition: all 0.5s ease;
            animation: alertGlowShift 5s ease infinite alternate;
        }
        html[data-theme="light"] .custom-alert-box::before { background: linear-gradient(45deg, var(--alert-glow-start-light), var(--alert-glow-end-light)); }
        .custom-alert-box:hover::before { filter: blur(20px); opacity: 1; transform: scale(1.03); animation: none; }
        @keyframes alertGlowShift {
            0% { background-position: 0% 0%; } 100% { background-position: 100% 100%; }
        }
        .custom-alert-box h2 {
            color: var(--alert-accent); font-size: 2em; 
            margin-bottom: 12px; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.25);
            transition: color 0.5s ease;
        }
        .custom-alert-box p {
            font-size: 1.35em; margin-bottom: 25px; line-height: 1.5;
            font-weight: bold; color: var(--alert-text);
            animation: colorChange 2s infinite alternate; transition: color 0.5s ease;
        }
        @keyframes colorChange { 
            0%   { color: var(--alert-accent); } 25%  { color: #e53935; } 
            50%  { color: #43a047; } 75%  { color: #fb8c00; } 100% { color: #2196f3; }
        }
         html[data-theme="light"] @keyframes colorChange {
            0%   { color: var(--alert-accent); } 25%  { color: #d32f2f; }
            50%  { color: #388e3c; } 75%  { color: #f57c00; } 100% { color: #1976d2; }
        }
        .custom-alert-box button {
            background-color: var(--alert-accent); color: var(--dark-text); 
            border: none; padding: 12px 25px; border-radius: 8px;
            cursor: pointer; font-size: 1.1em;
            transition: background-color 0.3s ease, transform 0.2s ease, color 0.5s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.35); font-weight: bold;
        }
        html[data-theme="light"] .custom-alert-box button { color: #000000; background-color: var(--alert-accent); }
        .custom-alert-box button:hover { background-color: #fdd835; transform: translateY(-3px) scale(1.05); box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4); }
        html[data-theme="light"] .custom-alert-box button:hover { background-color: #FFB300; }

        /* Gemini Modal Styles */
        .gemini-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--gemini-modal-bg-dark);
            display: flex; justify-content: center; align-items: center;
            z-index: 3000; opacity: 0; visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            backdrop-filter: blur(8px); 
        }
        html[data-theme="light"] .gemini-modal-overlay { background-color: var(--gemini-modal-bg-light); }

        .gemini-modal-overlay.show { opacity: 1; visibility: visible; }

        .gemini-modal-content {
            background-color: var(--gemini-modal-content-bg-dark);
            color: var(--gemini-modal-text-dark);
            padding: 25px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 90%; max-width: 600px;
            text-align: right; /* For Urdu content */
            transform: scale(0.8) translateY(-20px); opacity: 0;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
            max-height: 80vh; overflow-y: auto;
        }
        html[data-theme="light"] .gemini-modal-content {
             background-color: var(--gemini-modal-content-bg-light);
             color: var(--gemini-modal-text-light);
        }
        .gemini-modal-overlay.show .gemini-modal-content { transform: scale(1) translateY(0); opacity: 1; }

        .gemini-modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; border-bottom: 1px solid var(--accent-color); padding-bottom: 10px;
        }
        .gemini-modal-title {
            font-family: 'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', sans-serif;
            font-size: 2em; color: var(--gemini-modal-title-dark);
            font-weight: bold;
        }
        html[data-theme="light"] .gemini-modal-title { color: var(--gemini-modal-title-light); }

        .gemini-modal-close-btn {
            background: none; border: none; font-size: 2.5em;
            color: var(--gemini-modal-text-dark); cursor: pointer;
            line-height: 1; padding: 0 5px;
            transition: color 0.3s ease, transform 0.3s ease;
        }
        html[data-theme="light"] .gemini-modal-close-btn { color: var(--gemini-modal-text-light); }
        .gemini-modal-close-btn:hover { color: var(--hover-color); transform: rotate(90deg); }

        .gemini-modal-body {
            font-size: 1.2em; line-height: 1.8; 
            white-space: pre-wrap; /* Preserve line breaks from API */
            direction: rtl; /* Ensure Urdu text flows correctly */
            min-height: 100px; /* For loading indicator */
            display: flex; justify-content: center; align-items: center;
        }
        .gemini-modal-body p { margin-bottom: 1em; }

        .gemini-modal-input-container { margin-bottom: 20px; }
        .gemini-modal-input-container label {
            display: block; text-align: right; margin-bottom: 8px;
            font-weight: bold; font-size: 1.1em;
            color: var(--gemini-modal-text-dark);
        }
        html[data-theme="light"] .gemini-modal-input-container label {color: var(--gemini-modal-text-light); }

        .gemini-modal-input {
            width: 100%; padding: 10px; border-radius: 8px;
            border: 1px solid var(--gemini-input-border-dark);
            background-color: var(--gemini-input-bg-dark);
            color: var(--gemini-modal-text-dark);
            font-family: 'Noto Nastaliq Urdu', sans-serif; font-size: 1.1em;
            box-sizing: border-box;
        }
        html[data-theme="light"] .gemini-modal-input {
            border: 1px solid var(--gemini-input-border-light);
            background-color: var(--gemini-input-bg-light);
            color: var(--gemini-modal-text-light);
        }
        .gemini-modal-input:focus {
            outline: none; border-color: var(--accent-color);
            box-shadow: 0 0 0 2px var(--accent-color);
        }
        .gemini-modal-submit-btn {
            background-color: var(--gemini-btn-primary-bg-dark);
            color: white;
            border: none; padding: 10px 20px; border-radius: 8px;
            cursor: pointer; font-family: 'Noto Nastaliq Urdu', sans-serif;
            font-size: 1.1em; font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: block; width: 100%; margin-top: 10px;
        }
        html[data-theme="light"] .gemini-modal-submit-btn {
             background-color: var(--gemini-btn-primary-bg-light);
        }
        .gemini-modal-submit-btn:hover {
            background-color: var(--gemini-btn-primary-hover-dark);
            transform: translateY(-2px);
        }
        html[data-theme="light"] .gemini-modal-submit-btn:hover {
             background-color: var(--gemini-btn-primary-hover-light);
        }


        .loading-spinner {
            border: 5px solid var(--light-text); /* Light grey */
            border-top: 5px solid var(--accent-color); /* Blue */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        html[data-theme="light"] .loading-spinner {
            border: 5px solid var(--dark-text); 
            border-top: 5px solid var(--accent-color);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        @media (max-width: 768px) {
            header h1 { font-size: clamp(2em, 4vw, 2.8em); }
            .header-buttons { gap: 10px; margin-top: 10px; }
            .theme-toggle-button, .whatsapp-button, .gemini-generate-btn { width: 42px; height: 42px; font-size: 1.5em; }
            .gemini-generate-btn { width: auto; padding: 6px 12px; font-size: 0.9em; }
            .poetry-card { width: 90%; padding: 15px 20px; } /* Adjusted padding */
            .poetry-card h3 { font-size: 1.6em; }
            .poetry-card p { font-size: 1.25em; }
            .custom-alert-box { padding: 20px; max-width: 90%; }
            .custom-alert-box h2 { font-size: 1.7em; }
            .custom-alert-box p { font-size: 1.25em; }
            .footer-card { padding: 15px 25px; font-size: 1.05em; }
            .gemini-modal-title { font-size: 1.6em; }
            .gemini-modal-body { font-size: 1.1em; }
            .gemini-explain-btn { font-size: 0.85em; padding: 7px 12px;}
        }
         @media (max-width: 480px) {
            header h1 { font-size: clamp(1.8em, 5vw, 2.2em); }
            .welcome-text { font-size: clamp(3rem, 15vw, 7rem); }
            .poetry-card { width: 95%; padding: 12px 15px; } /* Adjusted padding */
            .poetry-card h3 { font-size: 1.4em; }
            .poetry-card p { font-size: 1.15em; }
            .custom-alert-box h2 { font-size: 1.5em; }
            .custom-alert-box p { font-size: 1.15em; }
            .custom-alert-box button { padding: 10px 20px; font-size: 1em; }
            .gemini-modal-title { font-size: 1.4em; }
            .gemini-modal-body { font-size: 1em; }
            .gemini-explain-btn { font-size: 0.8em; padding: 6px 10px;}
            .gemini-generate-btn { font-size: 0.8em; padding: 5px 10px; }
        }
    </style>
</head>
<body>
    <div id="welcomeOverlay" class="welcome-overlay">
        <div class="welcome-text">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</div>
    </div>

    <header>
        <div class="header-content">
            <h1>Ø§Ø±Ø¯Ùˆ Ø´Ø§Ø¹Ø±ÛŒ</h1>
        </div>
        <div class="header-buttons">
            <button id="themeToggle" class="theme-toggle-button" title="ØªÚ¾ÛŒÙ… ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº">
                <span class="icon">ğŸŒ™</span>
            </button>
            <a href="https://wa.me/+923001881920?text=Hello%20I%20have%20a%20question" target="_blank" class="whatsapp-button" title="WhatsApp Ù¾Ø± Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚº">
                <span class="icon">ğŸ’¬</span>
            </a>
        </div>
    </header>

    <div class="poetry-container-wrapper">
        <div class="global-actions">
            <button id="generatePoemBtn" class="gemini-generate-btn" title="AI Ø³Û’ Ù†Ø¸Ù… Ù„Ú©Ú¾ÙˆØ§Ø¦ÛŒÚº">
                âœ¨ AI Ø³Û’ Ù†Ø¸Ù… Ù„Ú©Ú¾ÙˆØ§Ø¦ÛŒÚº
            </button>
        </div>
        <div class="poetry-container">
            <div class="poetry-card" data-aos="fade-up" data-aos-delay="100">
                <h3>ØºØ§Ù„Ø¨</h3>
                <p class="poetry-text">ÛØ²Ø§Ø±ÙˆÚº Ø®ÙˆØ§ÛØ´ÛŒÚº Ø§ÛŒØ³ÛŒ Ú©Û ÛØ± Ø®ÙˆØ§ÛØ´ Ù¾Û Ø¯Ù… Ù†Ú©Ù„Û’<br>Ø¨ÛØª Ù†Ú©Ù„Û’ Ù…Ø±Û’ Ø§Ø±Ù…Ø§Ù† Ù„ÛŒÚ©Ù† Ù¾Ú¾Ø± Ø¨Ú¾ÛŒ Ú©Ù… Ù†Ú©Ù„Û’</p>
                <div class="poetry-card-actions">
                    <button class="gemini-explain-btn">âœ¨ ØªØ´Ø±ÛŒØ­</button>
                </div>
            </div>
            <div class="poetry-card" data-aos="fade-up" data-aos-delay="200">
                <h3>Ø§Ù‚Ø¨Ø§Ù„</h3>
                <p class="poetry-text">Ø³ØªØ§Ø±ÙˆÚº Ø³Û’ Ø¢Ú¯Û’ Ø¬ÛØ§Úº Ø§ÙˆØ± Ø¨Ú¾ÛŒ ÛÛŒÚº<br>Ø§Ø¨Ú¾ÛŒ Ø¹Ø´Ù‚ Ú©Û’ Ø§Ù…ØªØ­Ø§Ù† Ø§ÙˆØ± Ø¨Ú¾ÛŒ ÛÛŒÚº</p>
                <div class="poetry-card-actions">
                    <button class="gemini-explain-btn">âœ¨ ØªØ´Ø±ÛŒØ­</button>
                </div>
            </div>
            <div class="poetry-card" data-aos="fade-up" data-aos-delay="300">
                <h3>ÙÛŒØ¶</h3>
                <p class="poetry-text">Ú¯Ù„ Ø§Ø³ Ú¯Ù„Ø´Ù† Ù…ÛŒÚº Ú©Ú¾Ù„ÛŒÚº Ú©Û Ù†Û Ú©Ú¾Ù„ÛŒÚº<br>ÛÙ… ÙˆÛ Ø¹Ø§Ø´Ù‚ ÛÛŒÚº Ø¬Ùˆ Ù…Ù„Û’ Ù†Û Ù…Ù„Û’</p>
                <div class="poetry-card-actions">
                    <button class="gemini-explain-btn">âœ¨ ØªØ´Ø±ÛŒØ­</button>
                </div>
            </div>
             <div class="poetry-card" data-aos="fade-up" data-aos-delay="100">
                <h3>Ù…Ø±Ø²Ø§ ØºØ§Ù„Ø¨</h3>
                <p class="poetry-text">Ø¯Ù„ ÛÛŒ ØªÙˆ ÛÛ’ Ù†Û Ø³Ù†Ú¯ Ùˆ Ø®Ø´Øª Ø¯Ø±Ø¯ Ø³Û’ Ø¨Ú¾Ø± Ù†Û Ø¢Ø¦Û’ Ú©ÛŒÙˆÚº<br>Ø±ÙˆØ¦ÛŒÚº Ú¯Û’ ÛÙ… ÛØ²Ø§Ø± Ø¨Ø§Ø± Ú©ÙˆØ¦ÛŒ ÛÙ…ÛŒÚº Ø³ØªØ§Ø¦Û’ Ú©ÛŒÙˆÚº</p>
                <div class="poetry-card-actions">
                    <button class="gemini-explain-btn">âœ¨ ØªØ´Ø±ÛŒØ­</button>
                </div>
            </div>
            <div class="poetry-card" data-aos="fade-up" data-aos-delay="200">
                <h3>Ø¹Ù„Ø§Ù…Û Ø§Ù‚Ø¨Ø§Ù„</h3>
                <p class="poetry-text">Ø®ÙˆØ¯ÛŒ Ú©Ùˆ Ú©Ø± Ø¨Ù„Ù†Ø¯ Ø§ØªÙ†Ø§ Ú©Û ÛØ± ØªÙ‚Ø¯ÛŒØ± Ø³Û’ Ù¾ÛÙ„Û’<br>Ø®Ø¯Ø§ Ø¨Ù†Ø¯Û’ Ø³Û’ Ø®ÙˆØ¯ Ù¾ÙˆÚ†Ú¾Û’ Ø¨ØªØ§ ØªÛŒØ±ÛŒ Ø±Ø¶Ø§ Ú©ÛŒØ§ ÛÛ’</p>
                <div class="poetry-card-actions">
                    <button class="gemini-explain-btn">âœ¨ ØªØ´Ø±ÛŒØ­</button>
                </div>
            </div>
            <div class="poetry-card" data-aos="fade-up" data-aos-delay="300">
                <h3>ÙÛŒØ¶ Ø§Ø­Ù…Ø¯ ÙÛŒØ¶</h3>
                <p class="poetry-text">Ø±Ù‚Øµ Ø¨Ø³Ù…Ù„ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº Ø¯ÙˆØ³Øª ÛÙ…Ø§Ø±Û’ Ø³Ø§Ù…Ù†Û’<br>ÛÙ… ØªÙ…Ø§Ø´Ø§Ø¦ÛŒ ØªÙ…Ø§Ø´ÙˆÚº Ú©Û’ ØªÙ…Ø§Ø´Û’ Ø¯ÛŒÚ©Ú¾ØªÛ’ ÛÛŒÚº</p>
                <div class="poetry-card-actions">
                    <button class="gemini-explain-btn">âœ¨ ØªØ´Ø±ÛŒØ­</button>
                </div>
            </div>
            <div class="poetry-card" data-aos="fade-up" data-aos-delay="100">
                <h3>Ø¹Ù„Ø§Ù…Û Ø§Ù‚Ø¨Ø§Ù„</h3>
                <p class="poetry-text">Ø§ÙØ±Ø§Ø¯ Ú©Û’ ÛØ§ØªÚ¾ÙˆÚº Ù…ÛŒÚº ÛÛ’ Ø§Ù‚ÙˆØ§Ù… Ú©ÛŒ ØªÙ‚Ø¯ÛŒØ±<br>ÙˆÛ ÛØ± ÙØ±Ø¯ ÛÛ’ Ù…Ù„Øª Ú©Û’ Ù…Ù‚Ø¯Ø± Ú©Ø§ Ø³ØªØ§Ø±Û</p>
                <div class="poetry-card-actions">
                    <button class="gemini-explain-btn">âœ¨ ØªØ´Ø±ÛŒØ­</button>
                </div>
            </div>
            <div class="poetry-card" data-aos="fade-up" data-aos-delay="200">
                <h3>Ø¹Ù„Ø§Ù…Û Ø§Ù‚Ø¨Ø§Ù„</h3>
                <p class="poetry-text">Ù„Ø¨ Ù¾Û Ø¢ØªÛŒ ÛÛ’ Ø¯Ø¹Ø§ Ø¨Ù† Ú©Û’ ØªÙ…Ù†Ø§ Ù…ÛŒØ±ÛŒ<br>Ø²Ù†Ø¯Ú¯ÛŒ Ø´Ù…Ø¹ Ú©ÛŒ ØµÙˆØ±Øª ÛÙˆ Ø®Ø¯Ø§ÛŒØ§ Ù…ÛŒØ±ÛŒ</p>
                <div class="poetry-card-actions">
                    <button class="gemini-explain-btn">âœ¨ ØªØ´Ø±ÛŒØ­</button>
                </div>
            </div>
            <div class="poetry-card" data-aos="fade-up" data-aos-delay="300">
                <h3>Ø§Ø­Ù…Ø¯ ÙØ±Ø§Ø²</h3>
                <p class="poetry-text">Ø±Ù†Ø¬Ø´ ÛÛŒ Ø³ÛÛŒ Ø¯Ù„ ÛÛŒ Ø¯Ú©Ú¾Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ø¢<br>Ø¢ Ù¾Ú¾Ø± Ø³Û’ Ù…Ø¬Ú¾Û’ Ú†Ú¾ÙˆÚ‘ Ú©Û’ Ø¬Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ø¢</p>
                <div class="poetry-card-actions">
                    <button class="gemini-explain-btn">âœ¨ ØªØ´Ø±ÛŒØ­</button>
                </div>
            </div>
            <div class="poetry-card" data-aos="fade-up" data-aos-delay="100">
                <h3>Ù¾Ø±ÙˆÛŒÙ† Ø´Ø§Ú©Ø±</h3>
                <p class="poetry-text">ÙˆÛ ØªÙˆ Ø®ÙˆØ¯ ÛÛŒ Ú†Ù„Û’ Ø¬Ø§ØªÛ’ ÛÛŒÚº ÛØ± Ø¨Ø§Ø± Ù…Ú¯Ø±<br>ÛØ± Ø¨Ø§Ø± Ø§Ù„Ú¯ Ø±Ø§Û Ø³Û’ Ú¯Ø²Ø±Û’ ÛÛŒÚº ÛÙ…</p>
                <div class="poetry-card-actions">
                    <button class="gemini-explain-btn">âœ¨ ØªØ´Ø±ÛŒØ­</button>
                </div>
            </div>
            <div class="poetry-card" data-aos="fade-up" data-aos-delay="200">
                <h3>Ù…Ø±Ø²Ø§ ØºØ§Ù„Ø¨</h3>
                <p class="poetry-text">ÛØ± Ø§ÛŒÚ© Ø¨Ø§Øª Ù¾Û Ú©ÛØªÛ’ ÛÙˆ ØªÙ… Ú©Û ØªÙˆ Ú©ÛŒØ§ ÛÛ’<br>ØªÙ…Ú¾ÛŒÚº Ú©ÛÙˆ Ú©Û ÛŒÛ Ø§Ù†Ø¯Ø§Ø² Ú¯ÙØªÚ¯Ùˆ Ú©ÛŒØ§ ÛÛ’</p>
                <div class="poetry-card-actions">
                    <button class="gemini-explain-btn">âœ¨ ØªØ´Ø±ÛŒØ­</button>
                </div>
            </div>
            <div class="poetry-card" data-aos="fade-up" data-aos-delay="300">
                <h3>Ø¹Ù„Ø§Ù…Û Ø§Ù‚Ø¨Ø§Ù„</h3>
                <p class="poetry-text">ÛØ²Ø§Ø±ÙˆÚº Ø³Ø§Ù„ Ù†Ø±Ú¯Ø³ Ø§Ù¾Ù†ÛŒ Ø¨Û’ Ù†ÙˆØ±ÛŒ Ù¾Û Ø±ÙˆØªÛŒ ÛÛ’<br>Ø¨Ú‘ÛŒ Ù…Ø´Ú©Ù„ Ø³Û’ ÛÙˆØªØ§ ÛÛ’ Ú†Ù…Ù† Ù…ÛŒÚº Ø¯ÛŒØ¯Û ÙˆØ± Ù¾ÛŒØ¯Ø§</p>
                <div class="poetry-card-actions">
                    <button class="gemini-explain-btn">âœ¨ ØªØ´Ø±ÛŒØ­</button>
                </div>
            </div>
            </div>
    </div>

    <footer>
        <div class="footer-card">
            <p>Â© <span id="currentYear"></span> Ø§Ø±Ø¯Ùˆ Ø´Ø§Ø¹Ø±ÛŒ. Ø¬Ù…Ù„Û Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ ÛÛŒÚºÛ”</p>
            <a href="https://wa.me/+923001881920?text=Hello%20I%20have%20a%20question" target="_blank">Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚº (WhatsApp)</a>
            <p class="akram-logo">ØªÛŒØ§Ø± Ú©Ø±Ø¯Û: Ø§Ú©Ø±Ù… Ø®Ø§Ù†</p>
        </div>
    </footer>

    <div id="customAlertOverlay" class="custom-alert-overlay">
        <div class="custom-alert-box">
            <h2 id="alertTitle">Ù†ÙˆÙ¹</h2>
            <p id="alertMessage">ğŒğ€ğƒğ„ ğğ˜ ğ€ğŠğ‘ğ€ğŒ ğŠğ‡ğ€ğ!!!</p>
            <button id="alertCloseButton"> CLOSE</button>
        </div>
    </div>

    <div id="geminiModalOverlay" class="gemini-modal-overlay">
        <div class="gemini-modal-content">
            <div class="gemini-modal-header">
                <h2 id="geminiModalTitle" class="gemini-modal-title">Ø§Û’ Ø¢Ø¦ÛŒ Ù…Ø¹Ø§ÙˆÙ†</h2>
                <button id="geminiModalCloseBtn" class="gemini-modal-close-btn">&times;</button>
            </div>
            <div id="geminiModalBody" class="gemini-modal-body">
                <div class="loading-spinner" style="display: none;"></div>
            </div>
        </div>
    </div>


    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // Initialize AOS
        AOS.init({
            duration: 900, 
            once: false, 
            offset: 50, 
        });

        // Update current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // Welcome Intro Logic
        const welcomeOverlay = document.getElementById('welcomeOverlay');
        if (welcomeOverlay) {
            const hideWelcomeOverlay = () => { welcomeOverlay.classList.add('hidden'); };
            const welcomeTimeout = setTimeout(hideWelcomeOverlay, 3500);
            welcomeOverlay.addEventListener('click', () => {
                clearTimeout(welcomeTimeout); 
                hideWelcomeOverlay();
            });
        }

        // Custom Alert Modal Logic
        const customAlertOverlay = document.getElementById('customAlertOverlay');
        const alertMessageElement = document.getElementById('alertMessage');
        const alertCloseButton = document.getElementById('alertCloseButton');
        const alertTitleElement = document.getElementById('alertTitle'); 

        function showAlert(message, title = "Ù†ÙˆÙ¹") { 
            alertTitleElement.textContent = title;
            alertMessageElement.innerHTML = message; 
            customAlertOverlay.classList.add('show');
        }
        function hideAlert() { customAlertOverlay.classList.remove('show'); }
        alertCloseButton.addEventListener('click', hideAlert);
        customAlertOverlay.addEventListener('click', (event) => {
            if (event.target === customAlertOverlay) { hideAlert(); }
        });

        // Theme Toggle Logic
        const themeToggleBtn = document.getElementById('themeToggle');
        const htmlElement = document.documentElement;

        function setTheme(theme) {
            htmlElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            const iconSpan = themeToggleBtn.querySelector('.icon');
            if (theme === 'dark') {
                iconSpan.textContent = 'ğŸŒ™';
                iconSpan.style.transform = 'rotate(0deg) scale(1)';
            } else {
                iconSpan.textContent = 'â˜€ï¸';
                iconSpan.style.transform = 'rotate(360deg) scale(1.1)';
            }
            applyRandomPoetryCardStrokes(); 
        }

        function toggleTheme() {
            const currentTheme = htmlElement.getAttribute('data-theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            let initialTheme = savedTheme || ((window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) ? 'light' : 'dark');
            setTheme(initialTheme); 

            if (welcomeOverlay) {
                welcomeOverlay.style.backgroundColor = initialTheme === 'light' ? 'var(--welcome-overlay-bg-light)' : 'var(--welcome-overlay-bg-dark)';
            }
            
            // Attach listeners for Gemini features after DOM is loaded
            attachGeminiEventListeners();
        });

        themeToggleBtn.addEventListener('click', toggleTheme);

        // Poetry Card Strokes Logic
        const poetryCardGradients = [
            ['#FF00FF', '#00FFFF'], ['#FFD700', '#FF69B4'], ['#00FF00', '#00BFFF'],
            ['#FF4500', '#FFD700'], ['#8A2BE2', '#4169E1'], ['#FF1493', '#1E90FF'],
            ['#7FFF00', '#00FA9A'], ['#FF6347', '#FFDAB9'], ['#40E0D0', '#20B2AA'],
            ['#EE82EE', '#DA70D6'], ['#F08080', '#F4A460'], ['#ADD8E6', '#87CEEB'],
            ['#98FB98', '#3CB371'], ['#FFC0CB', '#FFB6C1'], ['#DDA0DD', '#BA55D3'],
            ['#f7971e', '#ffd200'], ['#00c6ff', '#0072ff'], ['#c31432', '#240b36'],
            ['#11998e', '#38ef7d'], ['#fc4a1a', '#f7b733']
        ];
        function applyRandomPoetryCardStrokes() {
            document.querySelectorAll('.poetry-card').forEach(card => {
                const randomIndex = Math.floor(Math.random() * poetryCardGradients.length);
                const [start, end] = poetryCardGradients[randomIndex];
                card.style.setProperty('--card-stroke-start', start);
                card.style.setProperty('--card-stroke-end', end);
            });
        }

        // Alert on card click (excluding buttons)
        document.querySelectorAll('.poetry-card').forEach(card => {
            card.addEventListener('click', (event) => {
                if (event.target.closest('a, button, .gemini-explain-btn')) { return; }
                showAlert('<b>!!ğŒğ€ğƒğ„ ğğ˜ <br>ğ€ğŠğ‘ğ€ğŒ ğŠğ‡ğ€ğ</b>', ' CREATOR');
            });
        });

        // --- Gemini API Integration ---
        const geminiModalOverlay = document.getElementById('geminiModalOverlay');
        const geminiModalTitle = document.getElementById('geminiModalTitle');
        const geminiModalBody = document.getElementById('geminiModalBody');
        const geminiModalCloseBtn = document.getElementById('geminiModalCloseBtn');
        const generatePoemBtn = document.getElementById('generatePoemBtn');
        const loadingSpinner = geminiModalBody.querySelector('.loading-spinner');

        const API_KEY = "AIzaSyBUtCcM5FAnYmAJjpKad6UEcZLObyLgjhs"; // IMPORTANT: Leave empty for Canvas environment

        async function fetchFromGeminiAPI(promptText) {
            loadingSpinner.style.display = 'block';
            geminiModalBody.innerHTML = ''; // Clear previous content, keep spinner logic separate
            geminiModalBody.appendChild(loadingSpinner);


            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;
            
            const payload = {
                contents: [{ role: "user", parts: [{ text: promptText }] }]
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Gemini API Error:', errorData);
                    throw new Error(`API Error (${response.status}): ${errorData.error?.message || 'Unknown error'}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates.length > 0 &&
                    data.candidates[0].content && data.candidates[0].content.parts &&
                    data.candidates[0].content.parts.length > 0) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    console.error('Unexpected API response structure:', data);
                    throw new Error('No content found in API response.');
                }
            } catch (error) {
                console.error('Error fetching from Gemini API:', error);
                return `Ù…Ø¹Ø°Ø±ØªØŒ Ù…ÙˆØ§Ø¯ Ø­Ø§ØµÙ„ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø§ÛŒÚ© Ù…Ø³Ø¦Ù„Û Ù¾ÛŒØ´ Ø¢ÛŒØ§: ${error.message}`;
            } finally {
                loadingSpinner.style.display = 'none';
            }
        }

        function openGeminiModal(title, contentHTML = '', showInput = false, inputPlaceholder = '', submitCallback = null) {
            geminiModalTitle.textContent = title;
            geminiModalBody.innerHTML = ''; // Clear previous content

            if (showInput) {
                const inputContainer = document.createElement('div');
                inputContainer.className = 'gemini-modal-input-container';
                inputContainer.innerHTML = `
                    <label for="geminiThemeInput">Ù…ÙˆØ¶ÙˆØ¹ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº:</label>
                    <input type="text" id="geminiThemeInput" class="gemini-modal-input" placeholder="${inputPlaceholder}" dir="rtl">
                    <button id="geminiThemeSubmitBtn" class="gemini-modal-submit-btn">Ù†Ø¸Ù… Ù„Ú©Ú¾ÙˆØ§Ø¦ÛŒÚº</button>
                `;
                geminiModalBody.appendChild(inputContainer);
                
                const inputField = document.getElementById('geminiThemeInput');
                const submitBtn = document.getElementById('geminiThemeSubmitBtn');

                // Handle submission via button or Enter key
                const handleSubmit = async () => {
                    const theme = inputField.value.trim();
                    if (theme && submitCallback) {
                         // Show loading spinner inside the main body before clearing for new content
                        geminiModalBody.innerHTML = ''; // Clear input fields
                        loadingSpinner.style.display = 'block';
                        geminiModalBody.appendChild(loadingSpinner);
                        await submitCallback(theme); // submitCallback will handle updating the modal body
                    } else if (!theme) {
                        showAlert("Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§ÛŒÚ© Ù…ÙˆØ¶ÙˆØ¹ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚºÛ”", "Ø®Ø§Ù„ÛŒ Ù…ÙˆØ¶ÙˆØ¹");
                    }
                };
                submitBtn.addEventListener('click', handleSubmit);
                inputField.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        handleSubmit();
                    }
                });
                 // Focus on input field when modal with input opens
                setTimeout(() => inputField.focus(), 100);


            } else {
                 geminiModalBody.innerHTML = contentHTML; // For displaying results or loading
            }
            
            geminiModalOverlay.classList.add('show');
        }

        function closeGeminiModal() {
            geminiModalOverlay.classList.remove('show');
             // Clear body to prevent old content flash and stop spinner if it was somehow left
            geminiModalBody.innerHTML = ''; 
            loadingSpinner.style.display = 'none'; // Ensure spinner is hidden
            geminiModalBody.appendChild(loadingSpinner); // Re-add for next use
        }

        geminiModalCloseBtn.addEventListener('click', closeGeminiModal);
        geminiModalOverlay.addEventListener('click', (event) => {
            if (event.target === geminiModalOverlay) { closeGeminiModal(); }
        });

        function attachGeminiEventListeners() {
            // Explain Poetry Button Listeners
            document.querySelectorAll('.gemini-explain-btn').forEach(button => {
                button.addEventListener('click', async (event) => {
                    const card = event.target.closest('.poetry-card');
                    const poetName = card.querySelector('h3').textContent.trim();
                    const poetryText = card.querySelector('p.poetry-text').innerText.trim(); // Use innerText to get formatted lines

                    const prompt = `Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§Ø³ Ø§Ø±Ø¯Ùˆ Ø´Ø¹Ø± Ú©ÛŒ Ù…Ø®ØªØµØ± ØªØ´Ø±ÛŒØ­ Ú©Ø±ÛŒÚº Ø¬Ùˆ ${poetName} Ú©Ø§ ÛÛ’:\n\n"${poetryText}"\n\nØªØ´Ø±ÛŒØ­ ÙˆØ§Ø¶Ø­ Ø§ÙˆØ± Ø¢Ø³Ø§Ù† Ø§Ø±Ø¯Ùˆ Ù…ÛŒÚº ÛÙˆÙ†ÛŒ Ú†Ø§ÛÛŒÛ’Û” Ø§Ú¯Ø± Ù…Ù…Ú©Ù† ÛÙˆ ØªÙˆØŒ Ø´Ø¹Ø± Ú©Û’ Ø§Ø¯Ø¨ÛŒ Ù¾ÛÙ„ÙˆØ¤Úº ÛŒØ§ Ø³ÛŒØ§Ù‚ Ùˆ Ø³Ø¨Ø§Ù‚ Ù¾Ø± Ø¨Ú¾ÛŒ Ø±ÙˆØ´Ù†ÛŒ ÚˆØ§Ù„ÛŒÚºÛ”`;
                    
                    openGeminiModal(`"${poetName}" Ú©Û’ Ø´Ø¹Ø± Ú©ÛŒ ØªØ´Ø±ÛŒØ­`);
                    loadingSpinner.style.display = 'block'; // Show spinner immediately
                    geminiModalBody.innerHTML = ''; 
                    geminiModalBody.appendChild(loadingSpinner);


                    const explanation = await fetchFromGeminiAPI(prompt);
                    geminiModalBody.innerHTML = `<p style="direction: rtl; text-align: right;">${explanation.replace(/\n/g, '<br>')}</p>`;
                });
            });

            // Generate Poem Button Listener
            generatePoemBtn.addEventListener('click', () => {
                openGeminiModal(
                    'AI Ø³Û’ Ù†Ø¦ÛŒ Ù†Ø¸Ù… Ù„Ú©Ú¾ÙˆØ§Ø¦ÛŒÚº', 
                    '', 
                    true, 
                    'Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø§Ø±Ø´ØŒ Ù…Ø­Ø¨ØªØŒ Ø¢Ø²Ø§Ø¯ÛŒ', 
                    async (theme) => {
                        const prompt = `Ø§ÛŒÚ© Ù…Ø®ØªØµØ± Ø§Ø±Ø¯Ùˆ Ù†Ø¸Ù… (2 Ø³Û’ 4 Ù…ØµØ±Ø¹Û’) Ù…ÙˆØ¶ÙˆØ¹ "${theme}" Ù¾Ø± Ù„Ú©Ú¾ÛŒÚºÛ” Ù†Ø¸Ù… Ú©Ù„Ø§Ø³ÛŒÚ©ÛŒ Ø§Ø±Ø¯Ùˆ Ø´Ø§Ø¹Ø±ÛŒ Ú©Û’ Ø§Ù†Ø¯Ø§Ø² Ù…ÛŒÚº ÛÙˆÙ†ÛŒ Ú†Ø§ÛØ¦Û’ØŒ Ø¬Ø³ Ù…ÛŒÚº Ù‚Ø§ÙÛŒÛ Ø§ÙˆØ± Ø±Ø¯ÛŒÙ Ú©Ø§ Ø®ÛŒØ§Ù„ Ø±Ú©Ú¾Ø§ Ú¯ÛŒØ§ ÛÙˆÛ”`;
                        // The loading spinner is already handled by openGeminiModal/handleSubmit logic before this callback
                        const generatedPoem = await fetchFromGeminiAPI(prompt);
                        geminiModalTitle.textContent = `"${theme}" Ù¾Ø± AI Ú©ÛŒ Ù†Ø¸Ù…`; // Update title with theme
                        geminiModalBody.innerHTML = `<p style="direction: rtl; text-align: right; font-size: 1.3em; line-height: 2;">${generatedPoem.replace(/\n/g, '<br>')}</p><hr style="margin: 15px 0;"><p style="font-size: 0.8em; text-align: center; opacity: 0.7;">ÛŒÛ Ù†Ø¸Ù… AI Ù†Û’ Ø¨Ù†Ø§Ø¦ÛŒ ÛÛ’Û”</p>`;
                    }
                );
            });
        }

    </script>
</body>
</html>
